<div data-controller="client-profile photo" class="client-profile-container">

  <!-- Header -->
  <div class="client-header">
    <h1><%= @client.full_name %></h1>

    <div data-controller="menu" class="menu-wrapper">
      <button class="vertical-menu-toggle" data-action="click->menu#toggleMenu">â‰¡</button>

      <div data-menu-target="menu" class="menu hidden">

        <%= link_to t("clients.show.new_appointment"),
                    new_appointment_path(client_id: @client.id),
                    class: "menu-item" %>

        <%= link_to t("clients.show.edit_client"),
                    edit_client_path(@client),
                    class: "menu-item" %>

        <a href="#client-info"
           class="menu-item"
           data-action="click->client-profile#toggleInfo">
          <%= t("clients.show.info_tab") %>
        </a>

        <%= button_to t("clients.show.delete_client"),
            client_path(@client),
            method: :delete,
            data: { turbo_confirm: t("clients.show.delete_client_confirm") },
            class: "menu-item delete" %>

      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-button active"
            data-client-profile-target="tab"
            data-tab-name="styles"
            data-action="click->client-profile#showTab">
      <%= t("clients.show.styles_tab") %>
    </button>

    <button class="tab-button"
            data-client-profile-target="tab"
            data-tab-name="photos"
            data-action="click->client-profile#showTab">
      <%= t("clients.show.photos_tab") %>
    </button>
  </div>

  <!-- Styles Tab -->
  <div id="styles-tab" data-client-profile-target="tabContent" class="tab-content active">

    <% @client.service_notes.order(created_at: :desc).group_by { |n| n.created_at.to_date }.each do |date, notes| %>
      <div class="style-group">

        <h3><%= l(date, format: "%B %d") %></h3>

        <div class="photos-grid">
          <% notes.each do |note| %>
            <div class="service-note-thumb">
              <%= link_to client_service_note_path(@client, note) do %>
                <% if note.photos.attached? %>
                  <%= image_tag note.photos.first, class: "client-photo" %>
                <% else %>
                  <div class="no-photo"><%= t("clients.show.no_photo") %></div>
                <% end %>
              <% end %>

              <div class="note-actions">

                <%= link_to edit_client_service_note_path(@client, note), class: "edit-icon" do %>
                  <svg ...>...</svg>
                <% end %>

                <div data-controller="popover" class="popover">
                  <button class="popover-toggle" data-action="click->popover#toggle">â‹®</button>

                  <div class="popover-menu hidden" data-popover-target="menu">
                    <%= button_to t("clients.show.delete_style"),
                                  client_service_note_path(@client, note),
                                  method: :delete,
                                  data: { turbo_confirm: t("clients.show.delete_style_confirm") },
                                  class: "popover-item delete-button" %>
                  </div>
                </div>

              </div>
            </div>
          <% end %>
        </div>

      </div>
    <% end %>

  </div>

  <!-- Photos Tab -->
  <div id="photos-tab" data-client-profile-target="tabContent" class="tab-content hidden">

    <div class="photos-grid">
      <% @client.photos.each do |photo| %>
        <div class="photo-wrapper" data-action="click->photo#show touchstart->photo#touchStart touchend->photo#touchEnd">

          <%= image_tag photo, class: "client-photo", data: { photo_url: url_for(photo) } %>

          <%= button_to "ðŸ—‘",
              delete_photo_client_path(@client, photo.id),
              method: :delete,
              data: { turbo_confirm: t("clients.show.delete_photo") },
              class: "photo-delete-btn" %>

        </div>
      <% end %>
    </div>

    <% if @client.photos.attached? %>
      <%= button_to t("clients.show.delete_all_photos"),
            delete_all_photos_client_path(@client),
            method: :delete,
            data: { turbo_confirm: t("clients.show.delete_all_photos_confirm") },
            class: "button delete-all" %>
    <% end %>

  </div>

  <!-- Client Info -->
  <div id="client-info" data-client-profile-target="info" class="client-info hidden">
    <p><strong><%= t("clients.show.details.phone") %>:</strong> <%= @client.phone %></p>
    <p><strong><%= t("clients.show.details.hair_type") %>:</strong> <%= t("clients.hair.types.#{@client.hair_type.downcase}") if @client.hair_type %></p>
    <p><strong><%= t("clients.show.details.hair_length") %>:</strong> <%= t("clients.hair.lengths.#{@client.hair_length.downcase}") if @client.hair_length %></p>
    <p><strong><%= t("clients.show.details.hair_structure") %>:</strong> <%= t("clients.hair.structures.#{@client.hair_structure.downcase}") if @client.hair_structure %></p>
    <p><strong><%= t("clients.show.details.hair_density") %>:</strong> <%= t("clients.hair.density.#{@client.hair_density.downcase}") if @client.hair_density %></p>
    <p><strong><%= t("clients.show.details.scalp_condition") %>:</strong> <%= t("clients.hair.scalp.#{@client.scalp_condition.downcase}") if @client.scalp_condition %></p>
    <p><strong><%= t("clients.show.details.note") %>:</strong> <%= @client.note %></p>
  </div>

  <!-- Back -->
  <div class="actions">
    <%= link_to t("clients.back"), clients_path, class: "button secondary" %>
  </div>

  <!-- Modal viewer remains unchanged -->
  <div data-photo-target="modal" class="modal hidden">
    ...
  </div>

</div>
