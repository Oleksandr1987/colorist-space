<div class="period-filter">
  <div class="quick-filters">
    <% [
      ['7 днів', 7],
      ['14 днів', 14],
      ['1 місяць', 30],
      ['3 місяці', 90],
      ['6 місяців', 180],
      ['9 місяців', 270],
      ['1 рік', 365]
    ].each do |label, days| %>
      <% from_date = days.days.ago.to_date.to_s %>
      <% to_date = Date.today.to_s %>
      <% is_active = params[:from].to_s == from_date && params[:to].to_s == to_date %>

      <%= link_to label,
        url_for(request.query_parameters.merge(from: from_date, to: to_date)),
        class: "filter-button #{'active' if is_active}" %>
    <% end %>

    <%# ⬇️ Категорія-фільтр %>
    <% category_label = params[:category].presence || "Категорія" %>
    <% is_category_active = params[:category].present? %>
    <div class="dropdown" data-controller="dropdown">
      <button class="filter-button <%= 'active' if is_category_active %>" data-action="click->dropdown#toggle">
        <%= category_label %>
      </button>
      <div class="dropdown-menu hidden" data-dropdown-target="menu">
        <%= link_to "Всі категорії", expenses_analytics_path(from: params[:from], to: params[:to]), class: "dropdown-item" %>
        <% Expense::CATEGORIES.each do |cat| %>
          <%= link_to cat,
              expenses_analytics_path(from: params[:from], to: params[:to], category: cat),
              class: "dropdown-item" %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="custom-range">
    <%= form_with url: request.path, method: :get, local: true do %>
      <div class="form-section">
        <%= label_tag :from, "Від", class: "form-label" %>
        <%= date_field_tag :from, params[:from], class: "form-input small", required: true, max: Date.today %>
      </div>

      <div class="form-section">
        <%= label_tag :to, "До", class: "form-label" %>
        <%= date_field_tag :to, params[:to], class: "form-input small", required: true, max: Date.today %>
      </div>

      <div class="form-section">
        <%= submit_tag "Фільтрувати", class: "form-button primary full-width" %>
      </div>
    <% end %>
  </div>
</div>
