<h2>Appointments</h2>

<div class="form-actions">
  <%= link_to "New Appointment", new_appointment_path, class: "button primary full" %>
  <%= link_to "Calendar", calendar_appointments_path, class: "button primary full" %>
</div>

<div class="expenses-scroll-wrapper">
  <% @appointments_by_month.each do |month_name, appointments| %>
    <div class="monthly-expense-group" data-controller="collapse">
      <div class="month-header-aligned" data-action="click->collapse#toggle">
        <span class="month-header-title"><%= month_name %></span>
        <div class="month-header-right">
          <span class="month-header-amount"><%= appointments.count %> записів</span>
        </div>
      </div>

      <ul class="expenses-list collapsible hidden" data-collapse-target="content">
        <% appointments.sort_by { |a| [a.appointment_date, a.appointment_time] }.each do |appointment| %>
          <li class="expense-item with-actions">
            <div class="appointmnet-main-row">
              <div class="appointment-info">
                <strong>
                  <%= l(appointment.appointment_date, format: :default) %> /
                  <%= appointment.appointment_time.strftime("%H:%M") %>
                  <% if appointment.end_time.present? %>– <%= appointment.end_time.strftime("%H:%M") %><% end %>
                </strong>
                — <%= appointment.client.full_name %>
                <% if appointment.service_name.present? %>
                  — <%= appointment.service_name %>
                <% end %>
              </div>

              <div class="app-slot-icon-wrapper" data-controller="popover">
                <button class="popover-toggle" data-popover-target="button" data-action="click->popover#toggle">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                      class="lucide lucide-pencil-icon">
                    <path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/>
                    <path d="m15 5 4 4"/>
                  </svg>
                </button>

                <div class="popover-menu hidden" data-popover-target="menu">
                  <%= link_to edit_appointment_path(appointment) do %>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-pencil-icon">
                      <path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/>
                      <path d="m15 5 4 4"/>
                    </svg>
                    Edit
                  <% end %>

                  <%= button_to appointment_path(appointment),
                                method: :delete,
                                form: { data: { turbo_confirm: "Are you sure you want to delete this appointment?" } },
                                class: "menu-item delete-button" do %>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-trash2-icon">
                      <path d="M3 6h18"/>
                      <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                      <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                      <line x1="10" x2="10" y1="11" y2="17"/>
                      <line x1="14" x2="14" y1="11" y2="17"/>
                    </svg>
                    Delete
                  <% end %>
                </div>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  <% end %>
</div>
